<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>sourceIdentify.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>sourceIdentify.cxx</h1><a href="source_identify_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00002 <span class="comment">/*                             sourceIdentify.cxx                             */</span>
00003 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00004 <span class="comment">/* Task            : Source identification.                                   */</span>
00005 <span class="comment">/* Author          : Jurgen Knodlseder CESR (C) (all rights reserved)         */</span>
00006 <span class="comment">/* Revision        : 1.1.0                                                    */</span>
00007 <span class="comment">/* Date of version : 21-Jul-2005                                              */</span>
00008 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00009 <span class="comment">/* History :                                                                  */</span>
00010 <span class="comment">/* 1.0.0  20-May-2005  first version                                          */</span>
00011 <span class="comment">/* 1.1.0  21-Jul-2005  version 1, revision 1                                  */</span>
00012 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00013 
00014 <span class="comment">/* Includes _________________________________________________________________ */</span>
00015 <span class="preprocessor">#include &lt;time.h&gt;</span>    <span class="comment">// for "clock_t" type</span>
00016 <span class="preprocessor">#include "<a class="code" href="source_identify_8h.html">sourceIdentify.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="_parameters_8h.html">Parameters.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="_log_8h.html">Log.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="_catalogue_8h.html">Catalogue.h</a>"</span>
00020 
00021 
00022 <span class="comment">/* Namespace usage __________________________________________________________ */</span>
00023 <span class="keyword">using</span> <span class="keyword">namespace </span>sourceIdentify;
00024 
00025 
00026 <span class="comment">/* Globals __________________________________________________________________ */</span>
00027 
00028 
00029 <span class="comment">/* Constants ________________________________________________________________ */</span>
00030 
00031 
00032 <span class="comment">/* Type defintions __________________________________________________________ */</span>
00033 
00034 
00035 <span class="comment">/* Prototypes _______________________________________________________________ */</span>
00036 
00037 
00038 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00039 <span class="comment">/*                                application                                 */</span>
00040 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00041 <span class="comment">/* Task: Main application class.                                              */</span>
00042 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00043"></a><a class="code" href="classapplication.html">00043</a> <span class="keyword">class </span><a class="code" href="classapplication.html">application</a> : <span class="keyword">public</span> st_app::StApp {
00044 <span class="keyword">public</span>:
00045 
00046     <span class="comment">// Constructor</span>
<a name="l00047"></a><a class="code" href="classapplication.html#a0">00047</a>     <a class="code" href="classapplication.html#a0">application</a>(): <a class="code" href="classapplication.html#o0">m_f</a>("<a class="code" href="classapplication.html">application</a>", "", 2) {}
00048 
00049     <span class="comment">// Action</span>
<a name="l00050"></a><a class="code" href="classapplication.html#a1">00050</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classapplication.html#a1">run</a>() {
00051 
00052     <span class="comment">// Declare (and initialise) variables</span>
00053     <a class="code" href="namespacesource_identify.html#a38">Status</a>      status = <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>;
00054     clock_t     t_start;
00055     clock_t     t_stop;
00056     <span class="keywordtype">float</span>       t_elapse;
00057     Parameters  par;
00058     Catalogue   cat;
00059 
00060     <span class="comment">// Main do-loop to fall through in case of an error</span>
00061     <span class="keywordflow">do</span> {
00062 
00063       <span class="comment">// Save the execution start time</span>
00064       t_start = clock();
00065       
00066       <span class="comment">// Initialise log file</span>
00067       status = <a class="code" href="namespacesource_identify.html#a34">LogInit</a>(<a class="code" href="source_identify_8h.html#a2">TOOL_LOGFILE</a>, <a class="code" href="source_identify_8h.html#a1">TOOL_VERSION</a>, status);
00068       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>)
00069         <span class="keywordflow">continue</span>;
00070 
00071       <span class="comment">// Dump header</span>
00072       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00073          <span class="stringliteral">"************************************************************"</span>);
00074       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00075          <span class="stringliteral">"*                sourceIdentify (gtsrcid)                  *"</span>);
00076       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00077          <span class="stringliteral">"* -------------------------------------------------------- *"</span>);
00078       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00079          <span class="stringliteral">"* Revision : 1.1.0                                         *"</span>);
00080       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00081          <span class="stringliteral">"* Date     : 21 July 2005                                  *"</span>);
00082       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00083          <span class="stringliteral">"* Author   : Jurgen Knodlseder (CESR)                      *"</span>);
00084       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00085          <span class="stringliteral">"************************************************************"</span>);
00086 
00087       <span class="comment">// ...</span>
00088       st_app::AppParGroup &amp;pars(getParGroup(<a class="code" href="source_identify_8h.html#a0">TOOL_NAME</a>));
00089 
00090       <span class="comment">// Load task parameters</span>
00091       status = par.load(pars, status);
00092       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>) {
00093         <span class="keywordflow">if</span> (par.logTerse())
00094           <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a11">Error_3</a>, <span class="stringliteral">"%d : Error while loading task parameters."</span>, status);      
00095         <span class="keywordflow">continue</span>;
00096       }
00097 
00098       <span class="comment">// Dump task parameters</span>
00099       status = par.dump(status);
00100       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>) {
00101         <span class="keywordflow">if</span> (par.logTerse())
00102           <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a11">Error_3</a>, <span class="stringliteral">"%d : Error while dumping task parameters."</span>, status);      
00103         <span class="keywordflow">continue</span>;
00104       }
00105        
00106       <span class="comment">// Build counterpart catalogue</span>
00107       status = cat.build(&amp;par, status);
00108       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>) {
00109         <span class="keywordflow">if</span> (par.logTerse())
00110           <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a11">Error_3</a>, <span class="stringliteral">"%d : Error while building counterpart candidate"</span>
00111                        <span class="stringliteral">" catalogue."</span>, status);      
00112         <span class="keywordflow">continue</span>;
00113       }
00114 
00115       <span class="comment">// Save counterpart candidate catalogue</span>
00116       status = cat.save(&amp;par, status);
00117       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>) {
00118         <span class="keywordflow">if</span> (par.logTerse())
00119           <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a11">Error_3</a>, <span class="stringliteral">"%d : Error while saving counterpart candidate"</span>
00120                        <span class="stringliteral">" catalogue."</span>, status);      
00121         <span class="keywordflow">continue</span>;
00122       }
00123 
00124     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00125  
00126     <span class="comment">// Save the execution stop time and calculate elapsed time</span>
00127     t_stop = clock();
00128     t_elapse = (float)(t_stop - t_start) / (float)CLOCKS_PER_SEC;
00129 
00130     <span class="comment">// Dump termination message</span>
00131     <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">"Task terminated using %.3f sec CPU time."</span>, t_elapse);
00132    
00133     <span class="comment">// Finish log file</span>
00134     status = <a class="code" href="namespacesource_identify.html#a35">LogClose</a>(status);
00135     
00136     <span class="comment">// Return from task</span>
00137 <span class="comment">//    return 0;</span>
00138 }
00139 <span class="keyword">private</span>:
<a name="l00140"></a><a class="code" href="classapplication.html#o0">00140</a>     st_stream::StreamFormatter <a class="code" href="classapplication.html#o0">m_f</a>;
00141 };
00142 
00143 <span class="comment">// Create instance of tool</span>
00144 st_app::StAppFactory&lt;application&gt; <a class="code" href="source_identify_8cxx.html#a0">g_factory</a>(<a class="code" href="source_identify_8h.html#a0">TOOL_NAME</a>);
00145 
</pre></div><hr><address style="align: right;"><small>Generated on Fri Jul 22 21:03:26 2005 for sourceIdentify by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
