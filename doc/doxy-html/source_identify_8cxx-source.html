<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>sourceIdentify.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>sourceIdentify.cxx</h1><a href="source_identify_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00002 <span class="comment">/*                             sourceIdentify.cxx                             */</span>
00003 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00004 <span class="comment">/* Task            : Source identification.                                   */</span>
00005 <span class="comment">/* Author          : Jurgen Knodlseder CESR (C) (all rights reserved)         */</span>
00006 <span class="comment">/* Revision        : 1.0                                                      */</span>
00007 <span class="comment">/* Date of version : 25-Feb-2005                                              */</span>
00008 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00009 <span class="comment">/* History :                                                                  */</span>
00010 <span class="comment">/* 1.0   25-Feb-2005  first version                                           */</span>
00011 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00012 
00013 <span class="comment">/* Includes _________________________________________________________________ */</span>
00014 <span class="preprocessor">#include &lt;time.h&gt;</span>    <span class="comment">// for "clock_t" type</span>
00015 <span class="preprocessor">#include "<a class="code" href="source_identify_8h.html">sourceIdentify/sourceIdentify.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="_parameters_8h.html">sourceIdentify/Parameters.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="_log_8h.html">sourceIdentify/Log.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="_catalogue_8h.html">sourceIdentify/Catalogue.h</a>"</span>
00019 
00020 
00021 <span class="comment">/* Namespace usage __________________________________________________________ */</span>
00022 <span class="keyword">using</span> <span class="keyword">namespace </span>sourceIdentify;
00023 
00024 
00025 <span class="comment">/* Globals __________________________________________________________________ */</span>
00026 
00027 
00028 <span class="comment">/* Constants ________________________________________________________________ */</span>
00029 
00030 
00031 <span class="comment">/* Type defintions __________________________________________________________ */</span>
00032 
00033 
00034 <span class="comment">/* Prototypes _______________________________________________________________ */</span>
00035 
00036 
00037 <span class="preprocessor">#if USE_ST_APP</span>
00038 <span class="preprocessor"></span><span class="comment">/*----------------------------------------------------------------------------*/</span>
00039 <span class="comment">/*                                application                                 */</span>
00040 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00041 <span class="comment">/* Task: Main application class.                                              */</span>
00042 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00043 <span class="keyword">class </span>application : <span class="keyword">public</span> st_app::StApp {
00044 <span class="keyword">public</span>:
00045 
00046     <span class="comment">// Constructor</span>
00047     application(): m_f("application", "", 2) {}
00048 
00049     <span class="comment">// Action</span>
00050     <span class="keyword">virtual</span> <span class="keywordtype">void</span> run() {
00051 
00052     <span class="comment">// Declare (and initialise) variables</span>
00053     <a class="code" href="namespacesource_identify.html#a38">Status</a>      status = <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>;
00054     clock_t     t_start;
00055     clock_t     t_stop;
00056     <span class="keywordtype">float</span>       t_elapse;
00057     Parameters  par;
00058     Catalogue   cat;
00059 
00060     <span class="comment">// Main do-loop to fall through in case of an error</span>
00061     <span class="keywordflow">do</span> {
00062 
00063       <span class="comment">// Save the execution start time</span>
00064       t_start = clock();
00065       
00066       <span class="comment">// Initialise log file</span>
00067       status = <a class="code" href="namespacesource_identify.html#a32">LogInit</a>(<span class="stringliteral">"sourceIdentify.log"</span>, <span class="stringliteral">"sourceIdentify-1.0"</span>, status);
00068       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>)
00069         <span class="keywordflow">continue</span>;
00070 
00071       <span class="comment">// Dump header</span>
00072       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00073          <span class="stringliteral">"************************************************************"</span>);
00074       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00075          <span class="stringliteral">"*                      sourceIdentify                      *"</span>);
00076       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00077          <span class="stringliteral">"* -------------------------------------------------------- *"</span>);
00078       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00079          <span class="stringliteral">"* Revision : 1.0                                           *"</span>);
00080       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00081          <span class="stringliteral">"* Date     : 25 Februar 2005                               *"</span>);
00082       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00083          <span class="stringliteral">"* Author   : Jurgen Knodlseder (CESR)                      *"</span>);
00084       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00085          <span class="stringliteral">"************************************************************"</span>);
00086 
00087       st_app::AppParGroup &amp;pars(getParGroup(<span class="stringliteral">"sourceIdentify"</span>));
00088 
00089       <span class="comment">// Load task parameters</span>
00090       status = par.load(pars, status);
00091       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>) {
00092         <span class="keywordflow">if</span> (par.logError())
00093           <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a9">Error_3</a>, <span class="stringliteral">"%d : Error while loading task parameters."</span>, status);      
00094         <span class="keywordflow">continue</span>;
00095       }
00096 
00097       <span class="comment">// Dump task parameters</span>
00098       status = par.dump(status);
00099       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>) {
00100         <span class="keywordflow">if</span> (par.logError())
00101           <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a9">Error_3</a>, <span class="stringliteral">"%d : Error while dumping task parameters."</span>, status);      
00102         <span class="keywordflow">continue</span>;
00103       }
00104        
00105       <span class="comment">// Build counterpart catalogue</span>
00106       status = cat.build(&amp;par, status);
00107       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>) {
00108         <span class="keywordflow">if</span> (par.logError())
00109           <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a9">Error_3</a>, <span class="stringliteral">"%d : Error while building counterpart candidate"</span>
00110                        <span class="stringliteral">" catalogue."</span>, status);      
00111         <span class="keywordflow">continue</span>;
00112       }
00113 
00114       <span class="comment">// Save counterpart candidate catalogue</span>
00115       status = cat.save(&amp;par, status);
00116       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>) {
00117         <span class="keywordflow">if</span> (par.logError())
00118           <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a9">Error_3</a>, <span class="stringliteral">"%d : Error while saving counterpart candidate"</span>
00119                        <span class="stringliteral">" catalogue."</span>, status);      
00120         <span class="keywordflow">continue</span>;
00121       }
00122 
00123     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00124  
00125     <span class="comment">// Save the execution stop time and calculate elapsed time</span>
00126     t_stop = clock();
00127     t_elapse = (float)(t_stop - t_start) / (float)CLOCKS_PER_SEC;
00128 
00129     <span class="comment">// Dump termination message</span>
00130     <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">"Task terminated using %.3f sec CPU time."</span>, t_elapse);
00131    
00132     <span class="comment">// Finish log file</span>
00133     status = <a class="code" href="namespacesource_identify.html#a33">LogClose</a>(status);
00134     
00135     <span class="comment">// Return from task</span>
00136 <span class="comment">//    return 0;</span>
00137 }
00138 <span class="keyword">private</span>:
00139     st_stream::StreamFormatter m_f;
00140 };
00141 st_app::StAppFactory&lt;application&gt; g_factory(<span class="stringliteral">"sourceIdentify"</span>);
00142 <span class="preprocessor">#else</span>
00143 <span class="preprocessor"></span><span class="comment">/*----------------------------------------------------------------------------*/</span>
00144 <span class="comment">/*                                   main                                     */</span>
00145 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00146 <span class="comment">/* Task: Main function call.                                                  */</span>
00147 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00148"></a><a class="code" href="source_identify_8cxx.html#a0">00148</a> <span class="keywordtype">int</span> <a class="code" href="source_identify_8cxx.html#a0">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {
00149 
00150     <span class="comment">// Declare (and initialise) variables</span>
00151     <a class="code" href="namespacesource_identify.html#a38">Status</a>      status = <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>;
00152     clock_t     t_start;
00153     clock_t     t_stop;
00154     <span class="keywordtype">float</span>       t_elapse;
00155     Parameters  par;
00156     Catalogue   cat;
00157 
00158     <span class="comment">// Main do-loop to fall through in case of an error</span>
00159     <span class="keywordflow">do</span> {
00160 
00161       <span class="comment">// Save the execution start time</span>
00162       t_start = clock();
00163       
00164       <span class="comment">// Initialise log file</span>
00165       status = <a class="code" href="namespacesource_identify.html#a32">LogInit</a>(<span class="stringliteral">"sourceIdentify.log"</span>, <span class="stringliteral">"sourceIdentify-1.0"</span>, status);
00166       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>)
00167         <span class="keywordflow">continue</span>;
00168 
00169       <span class="comment">// Dump header</span>
00170       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00171          <span class="stringliteral">"************************************************************"</span>);
00172       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00173          <span class="stringliteral">"*                      sourceIdentify                      *"</span>);
00174       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00175          <span class="stringliteral">"* -------------------------------------------------------- *"</span>);
00176       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00177          <span class="stringliteral">"* Revision : 1.0                                           *"</span>);
00178       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00179          <span class="stringliteral">"* Date     : 21 November 2004                              *"</span>);
00180       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00181          <span class="stringliteral">"* Author   : Jurgen Knodlseder (CESR)                      *"</span>);
00182       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, 
00183          <span class="stringliteral">"************************************************************"</span>);
00184 
00185       <span class="comment">// Load task parameters</span>
00186       status = par.load(status);
00187       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>) {
00188         <span class="keywordflow">if</span> (par.logError())
00189           <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a9">Error_3</a>, <span class="stringliteral">"%d : Error while loading task parameters."</span>, status);      
00190         <span class="keywordflow">continue</span>;
00191       }
00192 
00193       <span class="comment">// Dump task parameters</span>
00194       status = par.dump(status);
00195       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>) {
00196         <span class="keywordflow">if</span> (par.logError())
00197           <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a9">Error_3</a>, <span class="stringliteral">"%d : Error while dumping task parameters."</span>, status);      
00198         <span class="keywordflow">continue</span>;
00199       }
00200        
00201       <span class="comment">// Build counterpart catalogue</span>
00202       status = cat.build(&amp;par, status);
00203       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>) {
00204         <span class="keywordflow">if</span> (par.logError())
00205           <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a9">Error_3</a>, <span class="stringliteral">"%d : Error while building counterpart candidate"</span>
00206                        <span class="stringliteral">" catalogue."</span>, status);      
00207         <span class="keywordflow">continue</span>;
00208       }
00209 
00210       <span class="comment">// Save counterpart candidate catalogue</span>
00211       status = cat.save(&amp;par, status);
00212       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>) {
00213         <span class="keywordflow">if</span> (par.logError())
00214           <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a9">Error_3</a>, <span class="stringliteral">"%d : Error while saving counterpart candidate"</span>
00215                        <span class="stringliteral">" catalogue."</span>, status);      
00216         <span class="keywordflow">continue</span>;
00217       }
00218 
00219     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00220  
00221     <span class="comment">// Save the execution stop time and calculate elapsed time</span>
00222     t_stop = clock();
00223     t_elapse = (float)(t_stop - t_start) / (float)CLOCKS_PER_SEC;
00224 
00225     <span class="comment">// Dump termination message</span>
00226     <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">"Task terminated using %.3f sec CPU time."</span>, t_elapse);
00227    
00228     <span class="comment">// Finish log file</span>
00229     status = <a class="code" href="namespacesource_identify.html#a33">LogClose</a>(status);
00230     
00231     <span class="comment">// Return from task</span>
00232     <span class="keywordflow">return</span> 0;
00233 
00234 }
00235 <span class="preprocessor">#endif</span>
00236 <span class="preprocessor"></span>
</pre></div><hr><address style="align: right;"><small>Generated on Mon Feb 28 18:34:26 2005 for sourceIdentify by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
