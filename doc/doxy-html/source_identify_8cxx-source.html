<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>sourceIdentify: sourceIdentify.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">gtsrcid</a></div>
<h1>sourceIdentify.cxx</h1><a href="source_identify_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*------------------------------------------------------------------------------</span>
00002 <span class="comment">Id ........: $Id: sourceIdentify.cxx,v 1.3 2006/02/01 13:33:37 jurgen Exp $</span>
00003 <span class="comment">Author ....: $Author: jurgen $</span>
00004 <span class="comment">Revision ..: $Revision: 1.3 $</span>
00005 <span class="comment">Date ......: $Date: 2006/02/01 13:33:37 $</span>
00006 <span class="comment">--------------------------------------------------------------------------------</span>
00007 <span class="comment">$Log: sourceIdentify.cxx,v $</span>
00008 <span class="comment">Revision 1.3  2006/02/01 13:33:37  jurgen</span>
00009 <span class="comment">Tried to fix Win32 compilation bugs.</span>
00010 <span class="comment">Change revision number to 1.3.2.</span>
00011 <span class="comment">Replace header information with CVS typeset information.</span>
00012 <span class="comment"></span>
00013 <span class="comment">------------------------------------------------------------------------------*/</span>
00014 
00015 <span class="comment">/* Includes _________________________________________________________________ */</span>
00016 <span class="preprocessor">#include &lt;time.h&gt;</span>    <span class="comment">// for "clock_t" type</span>
00017 <span class="preprocessor">#include "<a class="code" href="source_identify_8h.html">sourceIdentify.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="_parameters_8h.html">Parameters.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="_log_8h.html">Log.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="_catalogue_8h.html">Catalogue.h</a>"</span>
00021 
00022 
00023 <span class="comment">/* Namespace usage __________________________________________________________ */</span>
00024 <span class="keyword">using</span> <span class="keyword">namespace </span>sourceIdentify;
00025 
00026 
00027 <span class="comment">/* Globals __________________________________________________________________ */</span>
00028 
00029 
00030 <span class="comment">/* Constants ________________________________________________________________ */</span>
00031 
00032 
00033 <span class="comment">/* Type defintions __________________________________________________________ */</span>
00034 
00035 
00036 <span class="comment">/* Prototypes _______________________________________________________________ */</span>
00037 
00038 
00039 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00040 <span class="comment">/*                                application                                 */</span>
00041 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00042 <span class="comment">/* Task: Main application class.                                              */</span>
00043 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00044"></a><a class="code" href="classapplication.html">00044</a> <span class="keyword">class </span><a class="code" href="classapplication.html">application</a> : <span class="keyword">public</span> st_app::StApp {
00045 <span class="keyword">public</span>:
00046 
00047     <span class="comment">// Constructor</span>
<a name="l00048"></a><a class="code" href="classapplication.html#a0">00048</a>     <a class="code" href="classapplication.html#a0">application</a>(): <a class="code" href="classapplication.html#r0">m_f</a>(<span class="stringliteral">"application"</span>, <span class="stringliteral">""</span>, 2) {}
00049 
00050     <span class="comment">// Action</span>
<a name="l00051"></a><a class="code" href="classapplication.html#a1">00051</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classapplication.html#a1">run</a>() {
00052 
00053     <span class="comment">// Declare (and initialise) variables</span>
00054     <a class="code" href="namespacesource_identify.html#a38">Status</a>      status = <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>;
00055     clock_t     t_start;
00056     clock_t     t_stop;
00057     <span class="keywordtype">float</span>       t_elapse;
00058     <a class="code" href="classsource_identify_1_1_parameters.html">Parameters</a>  par;
00059     <a class="code" href="classsource_identify_1_1_catalogue.html">Catalogue</a>   cat;
00060 
00061     <span class="comment">// Main do-loop to fall through in case of an error</span>
00062     <span class="keywordflow">do</span> {
00063 
00064       <span class="comment">// Save the execution start time</span>
00065       t_start = clock();
00066       
00067       <span class="comment">// Initialise log file</span>
00068       status = <a class="code" href="namespacesource_identify.html#a34">LogInit</a>(<a class="code" href="source_identify_8h.html#a2">TOOL_LOGFILE</a>, <a class="code" href="source_identify_8h.html#a1">TOOL_VERSION</a>, status);
00069       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>)
00070         <span class="keywordflow">continue</span>;
00071 
00072       <span class="comment">// Dump header</span>
00073       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00074          <span class="stringliteral">"************************************************************"</span>);
00075       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00076          <span class="stringliteral">"*                sourceIdentify (gtsrcid)                  *"</span>);
00077       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00078          <span class="stringliteral">"* -------------------------------------------------------- *"</span>);
00079       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00080          <span class="stringliteral">"* Revision : 1.3.2                                         *"</span>);
00081       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00082          <span class="stringliteral">"* Date     : 1 February 2006                               *"</span>);
00083       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00084          <span class="stringliteral">"* Author   : Jurgen Knodlseder (CESR)                      *"</span>);
00085       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, 
00086          <span class="stringliteral">"************************************************************"</span>);
00087 
00088       <span class="comment">// ...</span>
00089       st_app::AppParGroup &amp;pars(getParGroup(<a class="code" href="source_identify_8h.html#a0">TOOL_NAME</a>));
00090 
00091       <span class="comment">// Load task parameters</span>
00092       status = par.<a class="code" href="classsource_identify_1_1_parameters.html#a2">load</a>(pars, status);
00093       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>) {
00094         <span class="keywordflow">if</span> (par.<a class="code" href="classsource_identify_1_1_parameters.html#a4">logTerse</a>())
00095           <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a11">Error_3</a>, <span class="stringliteral">"%d : Error while loading task parameters."</span>, status);      
00096         <span class="keywordflow">continue</span>;
00097       }
00098 
00099       <span class="comment">// Dump task parameters</span>
00100       status = par.<a class="code" href="classsource_identify_1_1_parameters.html#a3">dump</a>(status);
00101       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>) {
00102         <span class="keywordflow">if</span> (par.<a class="code" href="classsource_identify_1_1_parameters.html#a4">logTerse</a>())
00103           <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a11">Error_3</a>, <span class="stringliteral">"%d : Error while dumping task parameters."</span>, status);      
00104         <span class="keywordflow">continue</span>;
00105       }
00106        
00107       <span class="comment">// Build counterpart catalogue</span>
00108       status = cat.<a class="code" href="classsource_identify_1_1_catalogue.html#a2">build</a>(&amp;par, status);
00109       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>) {
00110         <span class="keywordflow">if</span> (par.<a class="code" href="classsource_identify_1_1_parameters.html#a4">logTerse</a>())
00111           <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a11">Error_3</a>, <span class="stringliteral">"%d : Error while building counterpart candidate"</span>
00112                        <span class="stringliteral">" catalogue."</span>, status);      
00113         <span class="keywordflow">continue</span>;
00114       }
00115 
00116       <span class="comment">// Save counterpart candidate catalogue</span>
00117       status = cat.<a class="code" href="classsource_identify_1_1_catalogue.html#a3">save</a>(&amp;par, status);
00118       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>) {
00119         <span class="keywordflow">if</span> (par.<a class="code" href="classsource_identify_1_1_parameters.html#a4">logTerse</a>())
00120           <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a11">Error_3</a>, <span class="stringliteral">"%d : Error while saving counterpart candidate"</span>
00121                        <span class="stringliteral">" catalogue."</span>, status);      
00122         <span class="keywordflow">continue</span>;
00123       }
00124 
00125     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00126  
00127     <span class="comment">// Save the execution stop time and calculate elapsed time</span>
00128     t_stop = clock();
00129     t_elapse = (float)(t_stop - t_start) / (float)CLOCKS_PER_SEC;
00130 
00131     <span class="comment">// Dump termination message</span>
00132     <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">"Task terminated using %.3f sec CPU time."</span>, t_elapse);
00133    
00134     <span class="comment">// Finish log file</span>
00135     status = <a class="code" href="namespacesource_identify.html#a35">LogClose</a>(status);
00136     
00137     <span class="comment">// Return from task</span>
00138 <span class="comment">//    return 0;</span>
00139 }
00140 <span class="keyword">private</span>:
<a name="l00141"></a><a class="code" href="classapplication.html#r0">00141</a>     st_stream::StreamFormatter <a class="code" href="classapplication.html#r0">m_f</a>;
00142 };
00143 
00144 <span class="comment">// Create instance of tool</span>
00145 st_app::StAppFactory&lt;application&gt; <a class="code" href="source_identify_8cxx.html#a0">g_factory</a>(TOOL_NAME);
00146 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 1 17:08:56 2006 for sourceIdentify by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.1 </small></address>
</body>
</html>
