<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Parameters.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Parameters.cxx</h1><a href="_parameters_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00002 <span class="comment">/*                               Parameters.cxx                               */</span>
00003 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00004 <span class="comment">/* Task            : Parameter interface file.                                */</span>
00005 <span class="comment">/* Author          : Jurgen Knodlseder CESR (C) (all rights reserved)         */</span>
00006 <span class="comment">/* Revision        : 1.0                                                      */</span>
00007 <span class="comment">/* Date of version : 25-Feb-2005                                              */</span>
00008 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00009 <span class="comment">/* History :                                                                  */</span>
00010 <span class="comment">/* 1.0   25-Feb-2005  first version                                           */</span>
00011 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00012 
00013 <span class="comment">/* Includes _________________________________________________________________ */</span>
00014 <span class="preprocessor">#include &lt;stdio.h&gt;</span>                           <span class="comment">// for "sprintf" function</span>
00015 <span class="preprocessor">#include "<a class="code" href="source_identify_8h.html">sourceIdentify/sourceIdentify.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="_parameters_8h.html">sourceIdentify/Parameters.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="_log_8h.html">sourceIdentify/Log.h</a>"</span>              <span class="comment">// for parameter dumping/errors</span>
00018 
00019 <span class="comment">/* Namespace definition _____________________________________________________ */</span>
00020 <span class="keyword">namespace </span>sourceIdentify {
00021 
00022 
00023 <span class="comment">/* Type defintions __________________________________________________________ */</span>
00024 
00025 
00026 <span class="comment">/* Prototypes _______________________________________________________________ */</span>
00027 
00028 
00029 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00030 <span class="comment">/*                           Parameters::init_memory                          */</span>
00031 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00032 <span class="comment">/* Private method: init memory                                                */</span>
00033 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00034"></a><a class="code" href="classsource_identify_1_1_parameters.html#c0">00034</a> <span class="keywordtype">void</span> Parameters::init_memory(<span class="keywordtype">void</span>) {
00035 
00036     <span class="comment">// Declare local variables</span>
00037 
00038     <span class="comment">// Single loop for common exit point</span>
00039     <span class="keywordflow">do</span> {
00040 
00041       <span class="comment">// Intialise private members</span>
00042       <a class="code" href="classsource_identify_1_1_parameters.html#o0">m_srcCatName</a>.clear();
00043       <a class="code" href="classsource_identify_1_1_parameters.html#o1">m_cptCatName</a>.clear();
00044       <a class="code" href="classsource_identify_1_1_parameters.html#o2">m_outCatName</a>.clear();
00045       <a class="code" href="classsource_identify_1_1_parameters.html#o3">m_srcCatQty</a>.clear();
00046       <a class="code" href="classsource_identify_1_1_parameters.html#o4">m_cptCatQty</a>.clear();
00047       <a class="code" href="classsource_identify_1_1_parameters.html#o5">m_outCatQtyName</a>.clear();
00048       <a class="code" href="classsource_identify_1_1_parameters.html#o6">m_outCatQtyFormula</a>.clear();
00049       <a class="code" href="classsource_identify_1_1_parameters.html#o7">m_select</a>.clear();
00050       <a class="code" href="classsource_identify_1_1_parameters.html#o8">m_probMethod</a>.clear();
00051       <a class="code" href="classsource_identify_1_1_parameters.html#o10">maxNumCtp</a>    = 0;
00052       <a class="code" href="classsource_identify_1_1_parameters.html#o11">clobber</a>      = 0;
00053       <a class="code" href="classsource_identify_1_1_parameters.html#o12">verbose</a>      = 0;
00054 
00055     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00056     
00057     <span class="comment">// Return</span>
00058     <span class="keywordflow">return</span>;
00059 
00060 }
00061 
00062 
00063 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00064 <span class="comment">/*                            Parameters::free_memory                         */</span>
00065 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00066 <span class="comment">/* Private member: free memory                                                */</span>
00067 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00068"></a><a class="code" href="classsource_identify_1_1_parameters.html#c1">00068</a> <span class="keywordtype">void</span> Parameters::free_memory(<span class="keywordtype">void</span>) {
00069 
00070     <span class="comment">// Declare local variables</span>
00071 
00072     <span class="comment">// Single loop for common exit point</span>
00073     <span class="keywordflow">do</span> {
00074       
00075       <span class="comment">// Initialise memory</span>
00076       <a class="code" href="classsource_identify_1_1_parameters.html#c0">init_memory</a>();
00077 
00078     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00079     
00080     <span class="comment">// Return</span>
00081     <span class="keywordflow">return</span>;
00082 
00083 }
00084 
00085 
00086 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00087 <span class="comment">/*                              Parameters::load                              */</span>
00088 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00089 <span class="comment">/* Load parameters from task parameter file.                                  */</span>
00090 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00091 <span class="preprocessor">#if USE_ST_APP</span>
00092 <span class="preprocessor"></span><a class="code" href="namespacesource_identify.html#a38">Status</a> Parameters::load(st_app::AppParGroup &amp;pars, <a class="code" href="namespacesource_identify.html#a38">Status</a> status) {
00093 
00094     <span class="comment">// Declare local variables</span>
00095     <span class="keywordtype">long</span>                   i;
00096     <span class="keywordtype">char</span>                   parname[<a class="code" href="_parameters_8h.html#a0">MAX_CHAR</a>];
00097     std::string::size_type len;
00098     std::string::size_type pos;
00099     std::string::size_type len_name;
00100     std::string::size_type start_formula;
00101     std::string::size_type len_formula;
00102         
00103     <span class="comment">// Single loop for common exit point</span>
00104     <span class="keywordflow">do</span> {
00105 
00106       <span class="comment">// Fall through in case of an error</span>
00107       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>)
00108         <span class="keywordflow">continue</span>;
00109 
00110       <span class="comment">// Prompt for parameters</span>
00111       pars.Prompt();
00112 
00113       <span class="comment">// Recover task parameters</span>
00114       std::string s_srcCatName = pars[<span class="stringliteral">"srcCatName"</span>];
00115       std::string s_cptCatName = pars[<span class="stringliteral">"cptCatName"</span>];
00116       std::string s_outCatName = pars[<span class="stringliteral">"outCatName"</span>];
00117       std::string s_srcCatQty  = pars[<span class="stringliteral">"srcCatQty"</span>];
00118       std::string s_cptCatQty  = pars[<span class="stringliteral">"cptCatQty"</span>];
00119       std::string p_probMethod = pars[<span class="stringliteral">"probMethod"</span>];
00120       <a class="code" href="classsource_identify_1_1_parameters.html#o0">m_srcCatName</a>             = s_srcCatName;
00121       <a class="code" href="classsource_identify_1_1_parameters.html#o1">m_cptCatName</a>             = s_cptCatName;
00122       <a class="code" href="classsource_identify_1_1_parameters.html#o2">m_outCatName</a>             = s_outCatName;
00123       <a class="code" href="classsource_identify_1_1_parameters.html#o3">m_srcCatQty</a>              = s_srcCatQty;
00124       <a class="code" href="classsource_identify_1_1_parameters.html#o4">m_cptCatQty</a>              = s_cptCatQty;
00125       <a class="code" href="classsource_identify_1_1_parameters.html#o8">m_probMethod</a>             = p_probMethod;
00126       <a class="code" href="classsource_identify_1_1_parameters.html#o9">probThres</a>                = pars[<span class="stringliteral">"probThres"</span>];
00127       <a class="code" href="classsource_identify_1_1_parameters.html#o10">maxNumCtp</a>                = pars[<span class="stringliteral">"maxNumCtp"</span>];
00128       <a class="code" href="classsource_identify_1_1_parameters.html#o11">clobber</a>                  = pars[<span class="stringliteral">"clobber"</span>];
00129       <a class="code" href="classsource_identify_1_1_parameters.html#o12">verbose</a>                  = pars[<span class="stringliteral">"verbose"</span>];
00130 
00131       <span class="comment">// Retrieve new output quantities and decompose into quantity name and</span>
00132       <span class="comment">// evaluation string</span>
00133       <span class="keywordflow">for</span> (i = <a class="code" href="_parameters_8h.html#a1">MIN_OUTCAT_QTY</a>; i &lt;= <a class="code" href="_parameters_8h.html#a2">MAX_OUTCAT_QTY</a>; i++) {
00134         sprintf(parname, <span class="stringliteral">"outCatQty%2.2ld"</span>, i);
00135         std::string outCatQty = pars[parname];
00136         len = outCatQty.length();
00137         <span class="keywordflow">if</span> (len &gt; 0) {
00138           pos           = outCatQty.find(<span class="stringliteral">"="</span>,0);
00139           len_name      = pos;
00140           start_formula = pos + 1;
00141           len_formula   = len - start_formula;
00142           <span class="keywordflow">if</span> (pos == std::string::npos) {
00143             status = <a class="code" href="namespacesource_identify.html#a38a27">STATUS_PAR_BAD_PARAMETER</a>;
00144             <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a8">Error_2</a>, <span class="stringliteral">"%d : No equality symbol found in new output catalogue"</span>
00145                 <span class="stringliteral">" quantity string &lt;%s='%s'&gt;."</span>, 
00146                 (<a class="code" href="namespacesource_identify.html#a38">Status</a>)status, parname, outCatQty.c_str());
00147             <span class="keywordflow">break</span>;
00148           }
00149           <span class="keywordflow">if</span> (len_name &lt; 1) {
00150             status = <a class="code" href="namespacesource_identify.html#a38a27">STATUS_PAR_BAD_PARAMETER</a>;
00151             <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a8">Error_2</a>, <span class="stringliteral">"%d : No quantity name found for new output catalogue"</span>
00152                 <span class="stringliteral">" quantity &lt;%s='%s'&gt;."</span>, 
00153                 (<a class="code" href="namespacesource_identify.html#a38">Status</a>)status, parname, outCatQty.c_str());
00154             <span class="keywordflow">break</span>;
00155           }
00156           <span class="keywordflow">if</span> (len_formula &lt; 1) {
00157             status = <a class="code" href="namespacesource_identify.html#a38a27">STATUS_PAR_BAD_PARAMETER</a>;
00158             <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a8">Error_2</a>, <span class="stringliteral">"%d : No quantity evaluation string found for new"</span>
00159                 <span class="stringliteral">" output catalogue quantity &lt;%s='%s'&gt;."</span>, 
00160                 (<a class="code" href="namespacesource_identify.html#a38">Status</a>)status, parname, outCatQty.c_str());
00161             <span class="keywordflow">break</span>;
00162           }
00163           <a class="code" href="classsource_identify_1_1_parameters.html#o5">m_outCatQtyName</a>.push_back(outCatQty.substr(0, len_name));
00164           <a class="code" href="classsource_identify_1_1_parameters.html#o6">m_outCatQtyFormula</a>.push_back(outCatQty.substr(start_formula,
00165                                        len_formula));
00166         }
00167       }
00168       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>)
00169         <span class="keywordflow">continue</span>;
00170 
00171       <span class="comment">// Retrieve selection strings</span>
00172       <span class="keywordflow">for</span> (i = <a class="code" href="_parameters_8h.html#a3">MIN_OUTCAT_SEL</a>; i &lt;= <a class="code" href="_parameters_8h.html#a4">MAX_OUTCAT_SEL</a>; i++) {
00173         sprintf(parname, <span class="stringliteral">"select%2.2ld"</span>, i);
00174         std::string select = pars[parname];
00175         len = select.length();
00176         <span class="keywordflow">if</span> (len &gt; 0) {
00177           <a class="code" href="classsource_identify_1_1_parameters.html#o7">m_select</a>.push_back(select);
00178         }
00179       }
00180       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>)
00181         <span class="keywordflow">continue</span>;
00182 
00183     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00184     
00185     <span class="comment">// Return status</span>
00186     <span class="keywordflow">return</span> status;
00187 
00188 }
00189 <span class="preprocessor">#else</span>
<a name="l00190"></a><a class="code" href="classsource_identify_1_1_parameters.html#a2">00190</a> <span class="preprocessor"></span><a class="code" href="namespacesource_identify.html#a38">Status</a> Parameters::load(<a class="code" href="namespacesource_identify.html#a38">Status</a> status) {
00191 
00192     <span class="comment">// Single loop for common exit point</span>
00193     <span class="keywordflow">do</span> {
00194 
00195       <span class="comment">// Fall through in case of an error</span>
00196       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a22">STATUS_OK</a>)
00197         <span class="keywordflow">continue</span>;
00198 
00199       <span class="comment">// Initialise task parameters</span>
00200       sprintf(srcCatName, <span class="stringliteral">"../data/3EG_all.tsv"</span>);
00201       sprintf(cptCatName, <span class="stringliteral">"../data/1rxs_50.tsv"</span>);
00202       sprintf(outCatName, <span class="stringliteral">"output.fits"</span>);
00203       sprintf(srcCatQty,  <span class="stringliteral">"3EG,RAJ2000,DEJ2000,theta95"</span>);
00204       sprintf(cptCatQty,  <span class="stringliteral">"*"</span>);
00205       sprintf(probMethod,  <span class="stringliteral">"POSITION"</span>);
00206       numOutCatQty = 0;
00207       outCatQty    = NULL;
00208       <a class="code" href="classsource_identify_1_1_parameters.html#o9">probThres</a>    = 0.05;
00209       <a class="code" href="classsource_identify_1_1_parameters.html#o10">maxNumCtp</a>    = 100;
00210       numSelect    = 0;
00211       select       = NULL;
00212       <a class="code" href="classsource_identify_1_1_parameters.html#o11">clobber</a>      = 1;
00213       <a class="code" href="classsource_identify_1_1_parameters.html#o12">verbose</a>      = 4;
00214     
00215     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00216     
00217     <span class="comment">// Return status</span>
00218     <span class="keywordflow">return</span> status;
00219 
00220 }
00221 <span class="preprocessor">#endif</span>
00222 <span class="preprocessor"></span>
00223 <span class="comment">//Status Parameters::load(Status status) {</span>
00224 
00225 
00226 
00227 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00228 <span class="comment">/*                              Parameters::dump                              */</span>
00229 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00230 <span class="comment">/* Dump task parameters into log file.                                        */</span>
00231 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00232"></a><a class="code" href="classsource_identify_1_1_parameters.html#a3">00232</a> <a class="code" href="namespacesource_identify.html#a38">Status</a> Parameters::dump(<a class="code" href="namespacesource_identify.html#a38">Status</a> status) {
00233 
00234     <span class="comment">// Declare local variables</span>
00235     <span class="keywordtype">long</span>                   i;
00236     std::string::size_type n;
00237         
00238     <span class="comment">// Single loop for common exit point</span>
00239     <span class="keywordflow">do</span> {
00240 
00241       <span class="comment">// Dump task parameters</span>
00242       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">"Task Parameters:"</span>);
00243       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">"================"</span>);
00244       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">" Source catalogue filename ........: %s"</span>, 
00245           <a class="code" href="classsource_identify_1_1_parameters.html#o0">m_srcCatName</a>.c_str());
00246       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">" Counterpart catalogue name .......: %s"</span>, 
00247           <a class="code" href="classsource_identify_1_1_parameters.html#o1">m_cptCatName</a>.c_str());
00248       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">" Output catalogue name ............: %s"</span>, 
00249           <a class="code" href="classsource_identify_1_1_parameters.html#o2">m_outCatName</a>.c_str());
00250       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">" Source catalogue quantities ......: %s"</span>, 
00251           <a class="code" href="classsource_identify_1_1_parameters.html#o3">m_srcCatQty</a>.c_str());
00252       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">" Counterpart catalogue quantities .: %s"</span>, 
00253           <a class="code" href="classsource_identify_1_1_parameters.html#o4">m_cptCatQty</a>.c_str());
00254       <span class="keywordflow">if</span> ((n = <a class="code" href="classsource_identify_1_1_parameters.html#o5">m_outCatQtyName</a>.size()) &gt; 0) {
00255         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
00256           <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">" New output catalogue quantity %2d .: %s = %s"</span>, 
00257               i+1, <a class="code" href="classsource_identify_1_1_parameters.html#o5">m_outCatQtyName</a>[i].c_str(), <a class="code" href="classsource_identify_1_1_parameters.html#o6">m_outCatQtyFormula</a>[i].c_str());
00258         }
00259       }
00260       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">" Probability method ...............: %s"</span>, 
00261           <a class="code" href="classsource_identify_1_1_parameters.html#o8">m_probMethod</a>.c_str());
00262       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">" Probability threshold ............: %e"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#o9">probThres</a>);
00263       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">" Maximum number of counterparts  ..: %d"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#o10">maxNumCtp</a>);
00264       <span class="keywordflow">if</span> ((n = <a class="code" href="classsource_identify_1_1_parameters.html#o7">m_select</a>.size()) &gt; 0) {
00265         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
00266           <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">" Output catalogue selection %2d ....: %s"</span>, 
00267               i+1, <a class="code" href="classsource_identify_1_1_parameters.html#o7">m_select</a>[i].c_str());
00268         }
00269       }
00270       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">" Clobber ..........................: %d"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#o11">clobber</a>);
00271       <a class="code" href="namespacesource_identify.html#a34">Log</a>(<a class="code" href="namespacesource_identify.html#a37a19">Log_1</a>, <span class="stringliteral">" Verbose level ....................: %d"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#o12">verbose</a>);
00272     
00273     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00274     
00275     <span class="comment">// Return status</span>
00276     <span class="keywordflow">return</span> status;
00277 
00278 }
00279 
00280 
00281 <span class="comment">/* Namespace ends ___________________________________________________________ */</span>
00282 }
</pre></div><hr><address style="align: right;"><small>Generated on Mon Feb 28 18:34:26 2005 for sourceIdentify by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
