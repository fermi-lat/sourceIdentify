<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>sourceIdentify: Parameters.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">gtsrcid</a></div>
<h1>Parameters.cxx</h1><a href="_parameters_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*------------------------------------------------------------------------------</span>
00002 <span class="comment">Id ........: $Id: Parameters.cxx,v 1.3 2006/02/01 13:33:36 jurgen Exp $</span>
00003 <span class="comment">Author ....: $Author: jurgen $</span>
00004 <span class="comment">Revision ..: $Revision: 1.3 $</span>
00005 <span class="comment">Date ......: $Date: 2006/02/01 13:33:36 $</span>
00006 <span class="comment">--------------------------------------------------------------------------------</span>
00007 <span class="comment">$Log: Parameters.cxx,v $</span>
00008 <span class="comment">Revision 1.3  2006/02/01 13:33:36  jurgen</span>
00009 <span class="comment">Tried to fix Win32 compilation bugs.</span>
00010 <span class="comment">Change revision number to 1.3.2.</span>
00011 <span class="comment">Replace header information with CVS typeset information.</span>
00012 <span class="comment"></span>
00013 <span class="comment">------------------------------------------------------------------------------*/</span>
00014 
00015 <span class="comment">/* Includes _________________________________________________________________ */</span>
00016 <span class="preprocessor">#include &lt;stdio.h&gt;</span>                           <span class="comment">// for "sprintf" function</span>
00017 <span class="preprocessor">#include "<a class="code" href="source_identify_8h.html">sourceIdentify.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="_parameters_8h.html">Parameters.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="_log_8h.html">Log.h</a>"</span>                             <span class="comment">// for parameter dumping/errors</span>
00020 
00021 <span class="comment">/* Namespace definition _____________________________________________________ */</span>
00022 <span class="keyword">namespace </span>sourceIdentify {
00023 
00024 
00025 <span class="comment">/* Type defintions __________________________________________________________ */</span>
00026 
00027 
00028 <span class="comment">/* Prototypes _______________________________________________________________ */</span>
00029 
00030 
00031 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00032 <span class="comment">/*                           Parameters::init_memory                          */</span>
00033 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00034 <span class="comment">/* Private method: init memory                                                */</span>
00035 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00036"></a><a class="code" href="classsource_identify_1_1_parameters.html#d0">00036</a> <span class="keywordtype">void</span> Parameters::init_memory(<span class="keywordtype">void</span>) {
00037 
00038     <span class="comment">// Declare local variables</span>
00039 
00040     <span class="comment">// Single loop for common exit point</span>
00041     <span class="keywordflow">do</span> {
00042 
00043       <span class="comment">// Intialise private members</span>
00044       <a class="code" href="classsource_identify_1_1_parameters.html#r0">m_srcCatName</a>.clear();
00045       <a class="code" href="classsource_identify_1_1_parameters.html#r1">m_cptCatName</a>.clear();
00046       <a class="code" href="classsource_identify_1_1_parameters.html#r2">m_outCatName</a>.clear();
00047       <a class="code" href="classsource_identify_1_1_parameters.html#r3">m_srcCatQty</a>.clear();
00048       <a class="code" href="classsource_identify_1_1_parameters.html#r4">m_cptCatQty</a>.clear();
00049       <a class="code" href="classsource_identify_1_1_parameters.html#r5">m_outCatQtyName</a>.clear();
00050       <a class="code" href="classsource_identify_1_1_parameters.html#r6">m_outCatQtyFormula</a>.clear();
00051       <a class="code" href="classsource_identify_1_1_parameters.html#r7">m_select</a>.clear();
00052       <a class="code" href="classsource_identify_1_1_parameters.html#r8">m_probMethod</a>.clear();
00053       <a class="code" href="classsource_identify_1_1_parameters.html#r9">m_probThres</a>   = 0.0;
00054       <a class="code" href="classsource_identify_1_1_parameters.html#r10">m_srcPosError</a> = 0.0;
00055       <a class="code" href="classsource_identify_1_1_parameters.html#r11">m_cptPosError</a> = 0.0;
00056       <a class="code" href="classsource_identify_1_1_parameters.html#r12">m_maxNumCtp</a>   = 0;
00057       <a class="code" href="classsource_identify_1_1_parameters.html#r13">m_chatter</a>     = 0;
00058       <a class="code" href="classsource_identify_1_1_parameters.html#r14">m_clobber</a>     = 0;
00059       <a class="code" href="classsource_identify_1_1_parameters.html#r15">m_debug</a>       = 0;
00060       <a class="code" href="classsource_identify_1_1_parameters.html#r16">m_mode</a>.clear();
00061 
00062     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00063     
00064     <span class="comment">// Return</span>
00065     <span class="keywordflow">return</span>;
00066 
00067 }
00068 
00069 
00070 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00071 <span class="comment">/*                            Parameters::free_memory                         */</span>
00072 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00073 <span class="comment">/* Private member: free memory                                                */</span>
00074 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00075"></a><a class="code" href="classsource_identify_1_1_parameters.html#d1">00075</a> <span class="keywordtype">void</span> Parameters::free_memory(<span class="keywordtype">void</span>) {
00076 
00077     <span class="comment">// Declare local variables</span>
00078 
00079     <span class="comment">// Single loop for common exit point</span>
00080     <span class="keywordflow">do</span> {
00081       
00082       <span class="comment">// Initialise memory</span>
00083       <a class="code" href="classsource_identify_1_1_parameters.html#d0">init_memory</a>();
00084 
00085     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00086     
00087     <span class="comment">// Return</span>
00088     <span class="keywordflow">return</span>;
00089 
00090 }
00091 
00092 
00093 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00094 <span class="comment">/*                              Parameters::load                              */</span>
00095 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00096 <span class="comment">/* Load parameters from task parameter file.                                  */</span>
00097 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00098"></a><a class="code" href="classsource_identify_1_1_parameters.html#a2">00098</a> <a class="code" href="namespacesource_identify.html#a38">Status</a> Parameters::load(st_app::AppParGroup &amp;pars, Status status) {
00099 
00100     <span class="comment">// Declare local variables</span>
00101     <span class="keywordtype">long</span>                   i;
00102     <span class="keywordtype">char</span>                   parname[<a class="code" href="_parameters_8h.html#a0">MAX_CHAR</a>];
00103     std::string::size_type len;
00104     std::string::size_type pos;
00105     std::string::size_type len_name;
00106     std::string::size_type start_formula;
00107     std::string::size_type len_formula;
00108         
00109     <span class="comment">// Single loop for common exit point</span>
00110     <span class="keywordflow">do</span> {
00111 
00112       <span class="comment">// Fall through in case of an error</span>
00113       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>)
00114         <span class="keywordflow">continue</span>;
00115 
00116       <span class="comment">// Prompt for parameters</span>
00117       pars.Prompt();
00118 
00119       <span class="comment">// Recover task parameters</span>
00120       std::string s_srcCatName = pars[<span class="stringliteral">"srcCatName"</span>];
00121       std::string s_cptCatName = pars[<span class="stringliteral">"cptCatName"</span>];
00122       std::string s_outCatName = pars[<span class="stringliteral">"outCatName"</span>];
00123       std::string s_srcCatQty  = pars[<span class="stringliteral">"srcCatQty"</span>];
00124       std::string s_cptCatQty  = pars[<span class="stringliteral">"cptCatQty"</span>];
00125       std::string s_probMethod = pars[<span class="stringliteral">"probMethod"</span>];
00126       std::string s_mode       = pars[<span class="stringliteral">"mode"</span>];
00127       <a class="code" href="classsource_identify_1_1_parameters.html#r0">m_srcCatName</a>             = s_srcCatName;
00128       <a class="code" href="classsource_identify_1_1_parameters.html#r1">m_cptCatName</a>             = s_cptCatName;
00129       <a class="code" href="classsource_identify_1_1_parameters.html#r2">m_outCatName</a>             = s_outCatName;
00130       <a class="code" href="classsource_identify_1_1_parameters.html#r3">m_srcCatQty</a>              = s_srcCatQty;
00131       <a class="code" href="classsource_identify_1_1_parameters.html#r4">m_cptCatQty</a>              = s_cptCatQty;
00132       <a class="code" href="classsource_identify_1_1_parameters.html#r8">m_probMethod</a>             = s_probMethod;
00133       <a class="code" href="classsource_identify_1_1_parameters.html#r9">m_probThres</a>              = pars[<span class="stringliteral">"probThres"</span>];
00134       <a class="code" href="classsource_identify_1_1_parameters.html#r10">m_srcPosError</a>            = pars[<span class="stringliteral">"srcPosError"</span>];
00135       <a class="code" href="classsource_identify_1_1_parameters.html#r11">m_cptPosError</a>            = pars[<span class="stringliteral">"cptPosError"</span>];
00136       <a class="code" href="classsource_identify_1_1_parameters.html#r12">m_maxNumCtp</a>              = pars[<span class="stringliteral">"maxNumCtp"</span>];
00137       <a class="code" href="classsource_identify_1_1_parameters.html#r13">m_chatter</a>                = pars[<span class="stringliteral">"chatter"</span>];
00138       <a class="code" href="classsource_identify_1_1_parameters.html#r14">m_clobber</a>                = pars[<span class="stringliteral">"clobber"</span>];
00139       <a class="code" href="classsource_identify_1_1_parameters.html#r15">m_debug</a>                  = pars[<span class="stringliteral">"debug"</span>];
00140       <a class="code" href="classsource_identify_1_1_parameters.html#r16">m_mode</a>                   = s_mode;
00141 
00142       <span class="comment">// Retrieve new output quantities and decompose into quantity name and</span>
00143       <span class="comment">// evaluation string</span>
00144       <span class="keywordflow">for</span> (i = <a class="code" href="_parameters_8h.html#a1">MIN_OUTCAT_QTY</a>; i &lt;= <a class="code" href="_parameters_8h.html#a2">MAX_OUTCAT_QTY</a>; i++) {
00145         sprintf(parname, <span class="stringliteral">"outCatQty%2.2ld"</span>, i);
00146         std::string outCatQty = pars[parname];
00147         len = outCatQty.length();
00148         <span class="keywordflow">if</span> (len &gt; 0) {
00149           pos           = outCatQty.find(<span class="stringliteral">"="</span>,0);
00150           len_name      = pos;
00151           start_formula = pos + 1;
00152           len_formula   = len - start_formula;
00153           <span class="keywordflow">if</span> (pos == std::string::npos) {
00154             status = <a class="code" href="namespacesource_identify.html#a38a29">STATUS_PAR_BAD_PARAMETER</a>;
00155             <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a10">Error_2</a>, <span class="stringliteral">"%d : No equality symbol found in new output catalogue"</span>
00156                 <span class="stringliteral">" quantity string &lt;%s='%s'&gt;."</span>, 
00157                 (<a class="code" href="namespacesource_identify.html#a38">Status</a>)status, parname, outCatQty.c_str());
00158             <span class="keywordflow">break</span>;
00159           }
00160           <span class="keywordflow">if</span> (len_name &lt; 1) {
00161             status = <a class="code" href="namespacesource_identify.html#a38a29">STATUS_PAR_BAD_PARAMETER</a>;
00162             <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a10">Error_2</a>, <span class="stringliteral">"%d : No quantity name found for new output catalogue"</span>
00163                 <span class="stringliteral">" quantity &lt;%s='%s'&gt;."</span>, 
00164                 (<a class="code" href="namespacesource_identify.html#a38">Status</a>)status, parname, outCatQty.c_str());
00165             <span class="keywordflow">break</span>;
00166           }
00167           <span class="keywordflow">if</span> (len_formula &lt; 1) {
00168             status = <a class="code" href="namespacesource_identify.html#a38a29">STATUS_PAR_BAD_PARAMETER</a>;
00169             <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a10">Error_2</a>, <span class="stringliteral">"%d : No quantity evaluation string found for new"</span>
00170                 <span class="stringliteral">" output catalogue quantity &lt;%s='%s'&gt;."</span>, 
00171                 (<a class="code" href="namespacesource_identify.html#a38">Status</a>)status, parname, outCatQty.c_str());
00172             <span class="keywordflow">break</span>;
00173           }
00174           <a class="code" href="classsource_identify_1_1_parameters.html#r5">m_outCatQtyName</a>.push_back(outCatQty.substr(0, len_name));
00175           <a class="code" href="classsource_identify_1_1_parameters.html#r6">m_outCatQtyFormula</a>.push_back(outCatQty.substr(start_formula,
00176                                        len_formula));
00177         }
00178       }
00179       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>)
00180         <span class="keywordflow">continue</span>;
00181 
00182       <span class="comment">// Retrieve selection strings</span>
00183       <span class="keywordflow">for</span> (i = <a class="code" href="_parameters_8h.html#a3">MIN_OUTCAT_SEL</a>; i &lt;= <a class="code" href="_parameters_8h.html#a4">MAX_OUTCAT_SEL</a>; i++) {
00184         sprintf(parname, <span class="stringliteral">"select%2.2ld"</span>, i);
00185         std::string select = pars[parname];
00186         len = select.length();
00187         <span class="keywordflow">if</span> (len &gt; 0) {
00188           <a class="code" href="classsource_identify_1_1_parameters.html#r7">m_select</a>.push_back(select);
00189         }
00190       }
00191       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>)
00192         <span class="keywordflow">continue</span>;
00193 
00194     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00195     
00196     <span class="comment">// Return status</span>
00197     <span class="keywordflow">return</span> status;
00198 
00199 }
00200 
00201 
00202 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00203 <span class="comment">/*                              Parameters::dump                              */</span>
00204 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00205 <span class="comment">/* Dump task parameters into log file.                                        */</span>
00206 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00207"></a><a class="code" href="classsource_identify_1_1_parameters.html#a3">00207</a> <a class="code" href="namespacesource_identify.html#a38">Status</a> Parameters::dump(Status status) {
00208 
00209     <span class="comment">// Declare local variables</span>
00210     std::string::size_type i;
00211     std::string::size_type n;
00212         
00213     <span class="comment">// Single loop for common exit point</span>
00214     <span class="keywordflow">do</span> {
00215 
00216       <span class="comment">// Dump task parameters</span>
00217       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">"Task Parameters:"</span>);
00218       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">"================"</span>);
00219       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Source catalogue filename ........: %s"</span>, 
00220           <a class="code" href="classsource_identify_1_1_parameters.html#r0">m_srcCatName</a>.c_str());
00221       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Counterpart catalogue name .......: %s"</span>, 
00222           <a class="code" href="classsource_identify_1_1_parameters.html#r1">m_cptCatName</a>.c_str());
00223       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Output catalogue name ............: %s"</span>, 
00224           <a class="code" href="classsource_identify_1_1_parameters.html#r2">m_outCatName</a>.c_str());
00225       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Source catalogue quantities ......: %s"</span>, 
00226           <a class="code" href="classsource_identify_1_1_parameters.html#r3">m_srcCatQty</a>.c_str());
00227       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Counterpart catalogue quantities .: %s"</span>, 
00228           <a class="code" href="classsource_identify_1_1_parameters.html#r4">m_cptCatQty</a>.c_str());
00229       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Source catalogue uncertainty .....: %f arcmin"</span>,
00230           <a class="code" href="classsource_identify_1_1_parameters.html#r10">m_srcPosError</a>*60.0);
00231       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Counterpart catalogue uncertainty : %f arcmin"</span>,
00232           <a class="code" href="classsource_identify_1_1_parameters.html#r11">m_cptPosError</a>*60.0);
00233       <span class="keywordflow">if</span> ((n = <a class="code" href="classsource_identify_1_1_parameters.html#r5">m_outCatQtyName</a>.size()) &gt; 0) {
00234         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
00235           <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" New output catalogue quantity %2d .: %s = %s"</span>, 
00236               i+1, <a class="code" href="classsource_identify_1_1_parameters.html#r5">m_outCatQtyName</a>[i].c_str(), <a class="code" href="classsource_identify_1_1_parameters.html#r6">m_outCatQtyFormula</a>[i].c_str());
00237         }
00238       }
00239       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Probability method ...............: %s"</span>, 
00240           <a class="code" href="classsource_identify_1_1_parameters.html#r8">m_probMethod</a>.c_str());
00241       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Probability threshold ............: %e"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#r9">m_probThres</a>);
00242       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Maximum number of counterparts  ..: %d"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#r12">m_maxNumCtp</a>);
00243       <span class="keywordflow">if</span> ((n = <a class="code" href="classsource_identify_1_1_parameters.html#r7">m_select</a>.size()) &gt; 0) {
00244         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
00245           <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Output catalogue selection %2d ....: %s"</span>, 
00246               i+1, <a class="code" href="classsource_identify_1_1_parameters.html#r7">m_select</a>[i].c_str());
00247         }
00248       }
00249       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Chatter level of output ..........: %d"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#r13">m_chatter</a>);
00250       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Clobber ..........................: %d"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#r14">m_clobber</a>);
00251       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Debugging mode activated .........: %d"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#r15">m_debug</a>);
00252       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Mode of automatic parameters .....: %s"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#r16">m_mode</a>.c_str());
00253     
00254     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00255     
00256     <span class="comment">// Return status</span>
00257     <span class="keywordflow">return</span> status;
00258 
00259 }
00260 
00261 
00262 <span class="comment">/* Namespace ends ___________________________________________________________ */</span>
00263 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 1 17:08:56 2006 for sourceIdentify by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.1 </small></address>
</body>
</html>
