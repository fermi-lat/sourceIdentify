<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Parameters.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Parameters.cxx</h1><a href="_parameters_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00002 <span class="comment">/*                               Parameters.cxx                               */</span>
00003 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00004 <span class="comment">/* Task            : Parameter interface file.                                */</span>
00005 <span class="comment">/* Author          : Jurgen Knodlseder CESR (C) (all rights reserved)         */</span>
00006 <span class="comment">/* Revision        : 1.0.0                                                    */</span>
00007 <span class="comment">/* Date of version : 20-May-2005                                              */</span>
00008 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00009 <span class="comment">/* History :                                                                  */</span>
00010 <span class="comment">/* 1.0.0  20-May-2005  first version                                          */</span>
00011 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00012 
00013 <span class="comment">/* Includes _________________________________________________________________ */</span>
00014 <span class="preprocessor">#include &lt;stdio.h&gt;</span>                           <span class="comment">// for "sprintf" function</span>
00015 <span class="preprocessor">#include "<a class="code" href="source_identify_8h.html">sourceIdentify.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="_parameters_8h.html">Parameters.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="_log_8h.html">Log.h</a>"</span>                             <span class="comment">// for parameter dumping/errors</span>
00018 
00019 <span class="comment">/* Namespace definition _____________________________________________________ */</span>
00020 <span class="keyword">namespace </span>sourceIdentify {
00021 
00022 
00023 <span class="comment">/* Type defintions __________________________________________________________ */</span>
00024 
00025 
00026 <span class="comment">/* Prototypes _______________________________________________________________ */</span>
00027 
00028 
00029 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00030 <span class="comment">/*                           Parameters::init_memory                          */</span>
00031 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00032 <span class="comment">/* Private method: init memory                                                */</span>
00033 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00034"></a><a class="code" href="classsource_identify_1_1_parameters.html#c0">00034</a> <span class="keywordtype">void</span> Parameters::init_memory(<span class="keywordtype">void</span>) {
00035 
00036     <span class="comment">// Declare local variables</span>
00037 
00038     <span class="comment">// Single loop for common exit point</span>
00039     <span class="keywordflow">do</span> {
00040 
00041       <span class="comment">// Intialise private members</span>
00042       <a class="code" href="classsource_identify_1_1_parameters.html#o0">m_srcCatName</a>.clear();
00043       <a class="code" href="classsource_identify_1_1_parameters.html#o1">m_cptCatName</a>.clear();
00044       <a class="code" href="classsource_identify_1_1_parameters.html#o2">m_outCatName</a>.clear();
00045       <a class="code" href="classsource_identify_1_1_parameters.html#o3">m_srcCatQty</a>.clear();
00046       <a class="code" href="classsource_identify_1_1_parameters.html#o4">m_cptCatQty</a>.clear();
00047       <a class="code" href="classsource_identify_1_1_parameters.html#o5">m_outCatQtyName</a>.clear();
00048       <a class="code" href="classsource_identify_1_1_parameters.html#o6">m_outCatQtyFormula</a>.clear();
00049       <a class="code" href="classsource_identify_1_1_parameters.html#o7">m_select</a>.clear();
00050       <a class="code" href="classsource_identify_1_1_parameters.html#o8">m_probMethod</a>.clear();
00051       <a class="code" href="classsource_identify_1_1_parameters.html#o10">m_maxNumCtp</a> = 0;
00052       <a class="code" href="classsource_identify_1_1_parameters.html#o11">m_chatter</a>   = 0;
00053       <a class="code" href="classsource_identify_1_1_parameters.html#o12">m_clobber</a>   = 0;
00054       <a class="code" href="classsource_identify_1_1_parameters.html#o13">m_debug</a>     = 0;
00055       <a class="code" href="classsource_identify_1_1_parameters.html#o14">m_mode</a>.clear();
00056 
00057     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00058     
00059     <span class="comment">// Return</span>
00060     <span class="keywordflow">return</span>;
00061 
00062 }
00063 
00064 
00065 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00066 <span class="comment">/*                            Parameters::free_memory                         */</span>
00067 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00068 <span class="comment">/* Private member: free memory                                                */</span>
00069 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00070"></a><a class="code" href="classsource_identify_1_1_parameters.html#c1">00070</a> <span class="keywordtype">void</span> Parameters::free_memory(<span class="keywordtype">void</span>) {
00071 
00072     <span class="comment">// Declare local variables</span>
00073 
00074     <span class="comment">// Single loop for common exit point</span>
00075     <span class="keywordflow">do</span> {
00076       
00077       <span class="comment">// Initialise memory</span>
00078       <a class="code" href="classsource_identify_1_1_parameters.html#c0">init_memory</a>();
00079 
00080     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00081     
00082     <span class="comment">// Return</span>
00083     <span class="keywordflow">return</span>;
00084 
00085 }
00086 
00087 
00088 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00089 <span class="comment">/*                              Parameters::load                              */</span>
00090 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00091 <span class="comment">/* Load parameters from task parameter file.                                  */</span>
00092 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00093"></a><a class="code" href="classsource_identify_1_1_parameters.html#a2">00093</a> <a class="code" href="namespacesource_identify.html#a38">Status</a> Parameters::load(st_app::AppParGroup &amp;pars, <a class="code" href="namespacesource_identify.html#a38">Status</a> status) {
00094 
00095     <span class="comment">// Declare local variables</span>
00096     <span class="keywordtype">long</span>                   i;
00097     <span class="keywordtype">char</span>                   parname[<a class="code" href="_parameters_8h.html#a0">MAX_CHAR</a>];
00098     std::string::size_type len;
00099     std::string::size_type pos;
00100     std::string::size_type len_name;
00101     std::string::size_type start_formula;
00102     std::string::size_type len_formula;
00103         
00104     <span class="comment">// Single loop for common exit point</span>
00105     <span class="keywordflow">do</span> {
00106 
00107       <span class="comment">// Fall through in case of an error</span>
00108       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>)
00109         <span class="keywordflow">continue</span>;
00110 
00111       <span class="comment">// Prompt for parameters</span>
00112       pars.Prompt();
00113 
00114       <span class="comment">// Recover task parameters</span>
00115       std::string s_srcCatName = pars[<span class="stringliteral">"srcCatName"</span>];
00116       std::string s_cptCatName = pars[<span class="stringliteral">"cptCatName"</span>];
00117       std::string s_outCatName = pars[<span class="stringliteral">"outCatName"</span>];
00118       std::string s_srcCatQty  = pars[<span class="stringliteral">"srcCatQty"</span>];
00119       std::string s_cptCatQty  = pars[<span class="stringliteral">"cptCatQty"</span>];
00120       std::string s_probMethod = pars[<span class="stringliteral">"probMethod"</span>];
00121       std::string s_mode       = pars[<span class="stringliteral">"mode"</span>];
00122       <a class="code" href="classsource_identify_1_1_parameters.html#o0">m_srcCatName</a>             = s_srcCatName;
00123       <a class="code" href="classsource_identify_1_1_parameters.html#o1">m_cptCatName</a>             = s_cptCatName;
00124       <a class="code" href="classsource_identify_1_1_parameters.html#o2">m_outCatName</a>             = s_outCatName;
00125       <a class="code" href="classsource_identify_1_1_parameters.html#o3">m_srcCatQty</a>              = s_srcCatQty;
00126       <a class="code" href="classsource_identify_1_1_parameters.html#o4">m_cptCatQty</a>              = s_cptCatQty;
00127       <a class="code" href="classsource_identify_1_1_parameters.html#o8">m_probMethod</a>             = s_probMethod;
00128       <a class="code" href="classsource_identify_1_1_parameters.html#o9">m_probThres</a>              = pars[<span class="stringliteral">"probThres"</span>];
00129       <a class="code" href="classsource_identify_1_1_parameters.html#o10">m_maxNumCtp</a>              = pars[<span class="stringliteral">"maxNumCtp"</span>];
00130       <a class="code" href="classsource_identify_1_1_parameters.html#o11">m_chatter</a>                = pars[<span class="stringliteral">"chatter"</span>];
00131       <a class="code" href="classsource_identify_1_1_parameters.html#o12">m_clobber</a>                = pars[<span class="stringliteral">"clobber"</span>];
00132       <a class="code" href="classsource_identify_1_1_parameters.html#o13">m_debug</a>                  = pars[<span class="stringliteral">"debug"</span>];
00133       <a class="code" href="classsource_identify_1_1_parameters.html#o14">m_mode</a>                   = s_mode;
00134 
00135       <span class="comment">// Retrieve new output quantities and decompose into quantity name and</span>
00136       <span class="comment">// evaluation string</span>
00137       <span class="keywordflow">for</span> (i = <a class="code" href="_parameters_8h.html#a1">MIN_OUTCAT_QTY</a>; i &lt;= <a class="code" href="_parameters_8h.html#a2">MAX_OUTCAT_QTY</a>; i++) {
00138         sprintf(parname, <span class="stringliteral">"outCatQty%2.2ld"</span>, i);
00139         std::string outCatQty = pars[parname];
00140         len = outCatQty.length();
00141         <span class="keywordflow">if</span> (len &gt; 0) {
00142           pos           = outCatQty.find(<span class="stringliteral">"="</span>,0);
00143           len_name      = pos;
00144           start_formula = pos + 1;
00145           len_formula   = len - start_formula;
00146           <span class="keywordflow">if</span> (pos == std::string::npos) {
00147             status = <a class="code" href="namespacesource_identify.html#a38a29">STATUS_PAR_BAD_PARAMETER</a>;
00148             <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a10">Error_2</a>, <span class="stringliteral">"%d : No equality symbol found in new output catalogue"</span>
00149                 <span class="stringliteral">" quantity string &lt;%s='%s'&gt;."</span>, 
00150                 (<a class="code" href="namespacesource_identify.html#a38">Status</a>)status, parname, outCatQty.c_str());
00151             <span class="keywordflow">break</span>;
00152           }
00153           <span class="keywordflow">if</span> (len_name &lt; 1) {
00154             status = <a class="code" href="namespacesource_identify.html#a38a29">STATUS_PAR_BAD_PARAMETER</a>;
00155             <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a10">Error_2</a>, <span class="stringliteral">"%d : No quantity name found for new output catalogue"</span>
00156                 <span class="stringliteral">" quantity &lt;%s='%s'&gt;."</span>, 
00157                 (<a class="code" href="namespacesource_identify.html#a38">Status</a>)status, parname, outCatQty.c_str());
00158             <span class="keywordflow">break</span>;
00159           }
00160           <span class="keywordflow">if</span> (len_formula &lt; 1) {
00161             status = <a class="code" href="namespacesource_identify.html#a38a29">STATUS_PAR_BAD_PARAMETER</a>;
00162             <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a10">Error_2</a>, <span class="stringliteral">"%d : No quantity evaluation string found for new"</span>
00163                 <span class="stringliteral">" output catalogue quantity &lt;%s='%s'&gt;."</span>, 
00164                 (<a class="code" href="namespacesource_identify.html#a38">Status</a>)status, parname, outCatQty.c_str());
00165             <span class="keywordflow">break</span>;
00166           }
00167           <a class="code" href="classsource_identify_1_1_parameters.html#o5">m_outCatQtyName</a>.push_back(outCatQty.substr(0, len_name));
00168           <a class="code" href="classsource_identify_1_1_parameters.html#o6">m_outCatQtyFormula</a>.push_back(outCatQty.substr(start_formula,
00169                                        len_formula));
00170         }
00171       }
00172       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>)
00173         <span class="keywordflow">continue</span>;
00174 
00175       <span class="comment">// Retrieve selection strings</span>
00176       <span class="keywordflow">for</span> (i = <a class="code" href="_parameters_8h.html#a3">MIN_OUTCAT_SEL</a>; i &lt;= <a class="code" href="_parameters_8h.html#a4">MAX_OUTCAT_SEL</a>; i++) {
00177         sprintf(parname, <span class="stringliteral">"select%2.2ld"</span>, i);
00178         std::string select = pars[parname];
00179         len = select.length();
00180         <span class="keywordflow">if</span> (len &gt; 0) {
00181           <a class="code" href="classsource_identify_1_1_parameters.html#o7">m_select</a>.push_back(select);
00182         }
00183       }
00184       <span class="keywordflow">if</span> (status != <a class="code" href="namespacesource_identify.html#a38a24">STATUS_OK</a>)
00185         <span class="keywordflow">continue</span>;
00186 
00187     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00188     
00189     <span class="comment">// Return status</span>
00190     <span class="keywordflow">return</span> status;
00191 
00192 }
00193 
00194 
00195 <span class="comment">/*----------------------------------------------------------------------------*/</span>
00196 <span class="comment">/*                              Parameters::dump                              */</span>
00197 <span class="comment">/* -------------------------------------------------------------------------- */</span>
00198 <span class="comment">/* Dump task parameters into log file.                                        */</span>
00199 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00200"></a><a class="code" href="classsource_identify_1_1_parameters.html#a3">00200</a> <a class="code" href="namespacesource_identify.html#a38">Status</a> Parameters::dump(<a class="code" href="namespacesource_identify.html#a38">Status</a> status) {
00201 
00202     <span class="comment">// Declare local variables</span>
00203     <span class="keywordtype">long</span>                   i;
00204     std::string::size_type n;
00205         
00206     <span class="comment">// Single loop for common exit point</span>
00207     <span class="keywordflow">do</span> {
00208 
00209       <span class="comment">// Dump task parameters</span>
00210       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">"Task Parameters:"</span>);
00211       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">"================"</span>);
00212       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Source catalogue filename ........: %s"</span>, 
00213           <a class="code" href="classsource_identify_1_1_parameters.html#o0">m_srcCatName</a>.c_str());
00214       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Counterpart catalogue name .......: %s"</span>, 
00215           <a class="code" href="classsource_identify_1_1_parameters.html#o1">m_cptCatName</a>.c_str());
00216       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Output catalogue name ............: %s"</span>, 
00217           <a class="code" href="classsource_identify_1_1_parameters.html#o2">m_outCatName</a>.c_str());
00218       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Source catalogue quantities ......: %s"</span>, 
00219           <a class="code" href="classsource_identify_1_1_parameters.html#o3">m_srcCatQty</a>.c_str());
00220       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Counterpart catalogue quantities .: %s"</span>, 
00221           <a class="code" href="classsource_identify_1_1_parameters.html#o4">m_cptCatQty</a>.c_str());
00222       <span class="keywordflow">if</span> ((n = <a class="code" href="classsource_identify_1_1_parameters.html#o5">m_outCatQtyName</a>.size()) &gt; 0) {
00223         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
00224           <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" New output catalogue quantity %2d .: %s = %s"</span>, 
00225               i+1, <a class="code" href="classsource_identify_1_1_parameters.html#o5">m_outCatQtyName</a>[i].c_str(), <a class="code" href="classsource_identify_1_1_parameters.html#o6">m_outCatQtyFormula</a>[i].c_str());
00226         }
00227       }
00228       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Probability method ...............: %s"</span>, 
00229           <a class="code" href="classsource_identify_1_1_parameters.html#o8">m_probMethod</a>.c_str());
00230       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Probability threshold ............: %e"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#o9">m_probThres</a>);
00231       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Maximum number of counterparts  ..: %d"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#o10">m_maxNumCtp</a>);
00232       <span class="keywordflow">if</span> ((n = <a class="code" href="classsource_identify_1_1_parameters.html#o7">m_select</a>.size()) &gt; 0) {
00233         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
00234           <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Output catalogue selection %2d ....: %s"</span>, 
00235               i+1, <a class="code" href="classsource_identify_1_1_parameters.html#o7">m_select</a>[i].c_str());
00236         }
00237       }
00238       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Chatter level of output ..........: %d"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#o11">m_chatter</a>);
00239       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Clobber ..........................: %d"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#o12">m_clobber</a>);
00240       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Debugging mode activated .........: %d"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#o13">m_debug</a>);
00241       <a class="code" href="namespacesource_identify.html#a36">Log</a>(<a class="code" href="namespacesource_identify.html#a37a21">Log_1</a>, <span class="stringliteral">" Mode of automatic parameters .....: %s"</span>, <a class="code" href="classsource_identify_1_1_parameters.html#o14">m_mode</a>.c_str());
00242     
00243     } <span class="keywordflow">while</span> (0); <span class="comment">// End of main do-loop</span>
00244     
00245     <span class="comment">// Return status</span>
00246     <span class="keywordflow">return</span> status;
00247 
00248 }
00249 
00250 
00251 <span class="comment">/* Namespace ends ___________________________________________________________ */</span>
00252 }
</pre></div><hr><address style="align: right;"><small>Generated on Thu Jul 21 21:03:37 2005 for sourceIdentify by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
